void 0===window.pageTemplate&&(window.pageTemplate={}),window.pageTemplate.umtEditor="<div class=umt-editor><div class=\"J-item template item\"><div class=\"J-tool-min tool-min\"><a href=javascript: class=\"handle icon-close\"><i></i></a> <i class=\"icon_editor editor_text\" data-type=text></i> <i class=\"icon_editor editor_image\" data-type=img></i></div><div class=content><a href=javascript: class=\"J-remove remove icon-close\"><i></i></a> <textarea class=\"J-text type-text\" placeholder=请输入文本></textarea><div class=\"type-img upload\"><label class=\"J-preview preview\"><i class=\"icon_editor editor_image_gray\"></i> <span class=\"J-notice notice\" title=选择图片>选择图片</span> <input type=file accept=\"image/gif, image/jpg, image/jpeg, image/png, image/bmp\"> <img class=J-media></label></div></div></div><div class=\"J-tool tool\"><div class=\"J-add operate\" data-type=text><i class=\"icon_editor editor_text_gray\"></i><div>新建文字</div></div><div class=\"J-add operate\" data-type=img><i class=\"icon_editor editor_image_gray\"></i><div>新建图片</div></div></div></div>";window.UmtEditor={uploadUrl:"",imageType:["gif","jpg","jpeg","png","bmp"],videoType:["mp4","ogg","webm"],create:function(e){var t=this,i=$(window.pageTemplate.umtEditor),s=function(e){e.find(".J-tool-min").removeClass("show"),e.find(".J-preview").removeClass("show-preview"),e.find(".J-text").val(""),e.find(".J-desc").val(""),e.find(".J-media").attr("src","").removeAttr("data-id"),e.find(".J-notice").each(function(){var e=$(this);e.text(e.attr("title"))}),e.find('input[type="file"]').val("").prop("disabled",!1)},a=function(e,t){e.toggleClass("show-text","text"==t).toggleClass("show-img","img"==t).toggleClass("show-video","video"==t)};return i.find(".J-tool-min").click(function(){$(this).toggleClass("show")}),i.find(".J-tool-min > i").click(function(){var e=$(this),t=e.parents(".J-item"),i=t.clone(!0);t.before(i),s(i),a(i,e.data("type"))}),i.find(".J-add").click(function(){var e=$(this),t=e.parents(".J-tool"),i=t.prev(".J-item");i.hasClass("template")?i.removeClass("template"):(i=i.clone(!0),t.before(i),s(i)),a(i,e.data("type"))}),i.find(".J-remove").click(function(){var e=$(this).parents(".J-item");0==e.siblings(".J-item").length?(e.addClass("template"),s(e)):e.remove()}),i.find(".J-text").on("input",function(){$(this).css("height","80px").css("height",Math.max(80,this.scrollHeight)+"px")}),i.find('input[type="file"]').bind("change",function(){if(this.value&&"undefined"!=typeof FileReader){var e=new FileReader,t=this.files[0],i=$(this),s=i.parent(".J-preview");if(2*Math.pow(1024,2)<t.size)return void UNotice.show("上传图片不能大于2M",-1);i.prop("disabled",!0),s.removeClass("show-preview"),e.onloadend=function(){return this.error?void UNotice.show(this.error,-1):(i.next("img,video").attr({src:this.result}),void UmtEditor.upload(i,t))},e.readAsDataURL(t)}}),e=e||[],PageBase.cloneChild(".J-item",e.length,i,!0).each(function(i){var s,o,r,n=$(this),d=e[i];n.removeClass("template"),d.text?(n.find(".J-text").val(d.text),a(n,"text")):d.resource&&d.resource.path?(s=d.resource.path.match(/\w+$/),o=s&&s[0],r=t.videoType.indexOf(o)==-1?"img":"video",n.find(".J-preview").addClass("show-preview"),n.find(".J-desc").val(d.desc),n.find(r+".J-media").attr("src",Ui.buildImageUrl(d.resource.path)).data("res",d.resource),a(n,r)):n.remove()}),setTimeout(function(){i.find(".J-text").each(function(){$(this).css("height",Math.max(80,this.scrollHeight)+"px")})}),i},upload:function(e,t){var i=Tools.uploadFileHandle(UmtEditor.uploadUrl,t,function(t){1==t.status?(e.parent(".J-preview").addClass("show-preview"),e.prop("disabled",!1),e.next("img,video").data({res:t.data})):UNotice.show(t.msg,t.status)},function(t){var i="";"string"==typeof t?i=t:0<=t&&t<100&&(i="上传进度"+t+"%"),e.prev(".notice").text(i)});i===!1&&e.prop("disabled",!1)},parse:function(e){var t=[];return e.find(".J-item").each(function(){var e=$(this),i=e.find(".J-text").val(),s=e.find(".J-media:visible").data("res"),a=e.find(".J-desc:visible").val();i?t.push({text:i}):s&&t.push({resource:s,desc:a})}),0==t.length?null:t},view:function(e){if(!$.isArray(e))return"";var t,i,s,a,o,r="",n=this;for(t=0;t<e.length;++t)o=e[t],o.text?r+='<div class="article-text"><pre>'+o.text+"</pre></div>":(s=o.path.match(/\w+$/),a=s&&s[0],i=n.videoType.indexOf(a)==-1?'<img src="'+Ui.buildImageUrl(o.path)+'">':'<video src="'+Ui.buildImageUrl(o.path)+'" controls></video>',i='<div class="content">'+i+"</div>",o.desc&&(i+='<div class="desc">'+o.desc+"</div>"),r+='<div class="article-media">'+i+"</div>");return'<div class="umt-article">'+r+"</div>"}};