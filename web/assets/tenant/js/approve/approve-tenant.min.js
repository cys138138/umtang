window.ApproveTenant=PageBase.init(function(){this.initPage=function(){function a(a){function e(a,e){a&&e.siblings("img").replaceWith(Ui.buildImage(a))}if(!a.identity_card_front)return!1;a.other_info&&(a.other_info=a.other_info[0]);for(var t in a){var n=a[t],i=s.find("input[name="+t+"]");if(n)switch(t){case"bank_accout_type":$("input[type=radio][value='"+n.value+"']").prop("checked",!0);break;case"identity_card_front":case"identity_card_back":case"identity_card_in_hand":case"bank_card_photo":case"other_info":e(n.path,i);default:if("bank_name"==t){var r=n.value,o=r.match(/([\s\S]+)-([\s\S]+)/);o&&(n.value=o[1],s.find("input[name=bank_name_other]").val(o[2]))}i.val(n.value),n.reason&&s.find(".J-"+t+"-error").html(n.reason).show()}}}function e(a){function e(a,e){var t=s.find("input[name="+a+"]").focus();return UNotice.show(t[0].title+" 格式不正确",-1),t}if(0==a.is_draft)for(var t in a)switch(t){case"identity_card_front":case"identity_card_back":case"identity_card_in_hand":case"bank_card_photo":if(a[t].length<1||0==a[t])return e(t).parent().addClass("focus"),!1;break;case"other_info":case"bank_name_other":break;case"bank_account_holder":if(a[t].length<1)return e(t),!1;break;case"email":if(!Tools.isEmail(a[t]))return e(t),!1;break;default:if(a[t].length<1)return e(t),!1}return!0}var t=this,n=t.getConfig("selector"),i=t.getConfig("template"),r=t.getConfig("phpData"),o=t.getConfig("url"),s=$(n).append(i);s.find("input[type=file]").on("change",function(){var a=$(this),e=a.siblings(".J-progress").show();Tools.uploadFileHandle(o.uploadPicUrl,this.files[0],function(t){return a.parent().remove("focus"),e.html("").hide(),1!=t.status?(a.val(""),UNotice.show(t.msg,t.status),!1):(a.siblings("img").replaceWith(Ui.buildImage(t.data.path)),void a.siblings("input[type=text]").val(t.data.resource_id))},function(a){e.html("上传进度:"+a+"%")})}),s.find(".J-save").on("click",function(){var a=serializeObject(s.find("form")),t=$(this);a.is_draft=t.data("type"),e(a)&&(a.other_info=[a.other_info],a.bank_name=a.bank_name+(a.bank_name_other?"-"+a.bank_name_other:""),ajax({url:o.saveUrl,data:a}).done(function(e){UNotice.show(e.msg,e.status),1==e.status&&0==a.is_draft&&(location.href=o.shopUrl)}))}),a(r)}});