window.GoodsList=window.PageBase.init(function(){function t(t,a){t.toggleClass("hide",0==a.length),PageBase.cloneItem(t,a.length,!0,!0).each(function(t){var i=$(this),n=a[t];i.toggleClass("show-checking",1==n.is_pending),i.find(".J-name").text(n.name),i.find(".J-price").text(Tools.parsePrice(n.price)),i.find(".J-type").text(n.type_name),i.find(".J-create-date").text(Tools.date("Y-m-d",n.create_time)),i.find(".J-validity-date").text(Tools.date("Y-m-d",n.validity_time)),i.find(".J-edit").attr("href",e.editUrl.replace("_goods_id",n.id)).parent().data("id",n.id)})}var e={editUrl:"",listCache:[]};this.initPage=function(){var a=this,i=a.getConfig("selector"),n=a.getTemplate(),d=$(n);e.editUrl=a.getConfig("editUrl"),d.find(".J-build-btn").attr("href",a.getConfig("buildGoodsUrl"));var s=a.getConfig("goodsListUrl"),o=UmtPageNum.build();o.bind(UmtPageNum.EVENT_PAGE_CHANGE,function(a,i){var n=d.find(".J-item"),g=d.find(".J-tab.active").data("status"),l=[g,i].join("_");if(e.listCache[l])return UmtPageNum.update(o,i),void t(n,e.listCache[l]);var r=10;ajax({url:s,data:{page:i,status:g}}).done(function(a){var d=Math.ceil(a.data.count/r);e.listCache[l]=a.data.list,UmtPageNum.update(o,i,d),t(n,e.listCache[l])})}),d.find(".J-page-num").append(o);var g=d.find(".J-tab"),l=a.getConfig("aGoodsStatus");g.click(function(){var t=$(this);t.addClass("active").siblings().removeClass("active"),d.find(".J-main").toggleClass("show-stock","1"==t.data("status")),o.triggerHandler(UmtPageNum.EVENT_PAGE_CHANGE,1)}),PageBase.cloneItem(g,l.length,!0,!0).each(function(t){$(this).attr("data-status",l[t].key).text(l[t].value).toggleClass("active",0==t)});var r=a.getConfig("opUrl");d.find(".J-up, .J-down, .J-del").click(function(){var t=$(this),a=t.parent(),i=t.data("action"),n=t.text(),d=a.data("id"),s=a.siblings(".J-name").text();UNotice.confirm("确认"+n,"是否"+n+'服务"'+s+'"?',3==i?-1:1,function(){ajax({url:r,data:{goodsId:d,action:i}}).done(function(t){if(UNotice.show(t.msg,t.status),1==t.status){e.listCache=[];var a=UmtPageNum.getCurrentPage(o);o.triggerHandler(UmtPageNum.EVENT_PAGE_CHANGE,a)}})})}),$(i).append(d),o.triggerHandler(UmtPageNum.EVENT_PAGE_CHANGE,1)}});