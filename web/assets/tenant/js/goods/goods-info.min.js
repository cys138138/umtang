window.GoodsInfo=window.PageBase.init(function(){this.initPage=function(){var e=this,i=e.getConfig("selector"),t=e.getTemplate(),n=$(t);n.find("textarea").on("input",function(){$(this).css("height","60px").css("height",this.scrollHeight+"px")});var o,a="",d=e.getConfig("aType");for(o in d)d.hasOwnProperty(o)&&(a+='<option value="'+o+'">'+d[o]+"</option>");n.find(".J-type-select").html(a),n.find(".J-del").click(function(){$(this).parent().remove()});var l=e.getConfig("aGoodsInfo");l?(n.find('[name="name"]').val(l.name),n.find('[name="typeId"]').val(l.type_id),n.find('[name="price"]').val(Tools.parsePrice(l.price)),n.find('[name="retailPrice"]').val(Tools.parsePrice(l.retail_price)),n.find('[name="validityTime"]').val(Tools.date("Y-m-d",l.validity_time)),n.find('[name="appointmentDay"]').val(l.appointment_day),n.find('[name="suitPeople"]').val(l.suit_people),n.find('[name="maxClassPeople"]').val(l.max_class_people),n.find('[name="notice"]').val(l.notice),n.find(".J-album").removeClass("hide").attr("href",e.getConfig("albumUrl").replace("goods_id",l.id)),n.find("#album").parent().hide(),n.find(".J-title").text("服务列表-编辑服务")):(n.find(".J-title").text("服务列表-新建服务"),n.find('[type="file"]').on("change",function(){var i,t=this,n=!1,o=$(t),a=o.parent(),d=o.siblings('[type="checkbox"]');d.prop("checked")||(n=!0,i=a.clone(!0),i.find('input[type="file"]').val(""),a.after(i)),Tools.uploadFileHandle(e.getConfig("uploadUrl"),this.files[0],function(e){return a.removeClass("on-upload").find(".J-notice").text(""),1!=e.status?(n&&a.remove(),void UNotice.show(e.msg,e.msg)):(d.val(e.data.resource_id).prop("checked",!0),void Tools.setUrlByFileInput(t,o.siblings("img")))},function(e){a.addClass("on-upload").find(".J-notice").text("上传进度:"+e+"%")})})),n.find('[name="validityTime"]').datepicker({minDate:"+1D"}),n.find("#editor").append(UmtEditor.create(l&&l.description)),n.find(".J-form").on("submit",function(){var i="",t=$(this),o=serializeObject(t);return o.id=l?l.id:null,o.validityTime=new Date(o.validityTime+" 00:00:00").getTime()/1e3|0,o.price=Tools.restorePrice(o.price),o.retailPrice=Tools.restorePrice(o.retailPrice),o.description=UmtEditor.parse(n.find("#editor")),void 0==o.description?i="请填写图文介绍":o.id||0!=o.resourceIds||(i="请上传服务图片"),i?(UNotice.show(i,-1),!1):(ajax({url:e.getConfig("submitUrl"),data:o}).done(function(e){1==e.status&&UNotice.show(e.msg,e.status),o.id||history.back()}),!1)}),$(i).append(n)}});