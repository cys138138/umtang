window.ShopApply=PageBase.init(function(){this.initPage=function(){function a(a){var e,n=60;a.addClass("disable"),e=setInterval(function(){--n,0==n?(clearInterval(e),a.removeClass("disable").text("获取验证码")):a.text(n+"s后重新获取")},1e3)}function e(){for(var a in s){var e=s[a].value;if("bank_accout_type"!=a){if("bank_name"==a){var n=e.match(/([\s\S]+)-([\s\S]+)/);n?(e=n[1],c.find("input[name=bank_name_other]").val(n[2]),s[a].value=n[1],s.bank_name_other={value:n[2]}):s.bank_name_other={value:""}}c.find(".J-"+a).html(e),c.find("[name="+a+"]").val(e)}else $("input[type=radio][value='"+e+"']").prop("checked",!0)}c.find(".J-email-count").html(l.email),c.find(".J-bank-count").html(l.bank_accout),s.bank_card_photo&&s.bank_card_photo.path&&c.find("img").replaceWith(Ui.buildImage(s.bank_card_photo.path))}var n=this,t=n.getConfig("selector"),i=n.getConfig("template"),o=n.getConfig("url"),s=n.getConfig("phpData"),l=n.getConfig("countData"),r=n.getConfig("pageUrl"),c=$(t).html(i);for(var d in r)c.find(".J-tab-"+d).attr("href",r[d]);c.find(".J-close").on("click",function(){$(this).parents(".J-alert").hide()}).click(),c.find(".J-edit").on("click",function(){c.find(".J-alert[data-type="+$(this).data("type")+"]").show()}),c.find(".J-get-code").on("click",function(){var e=$(this),n=e.parents(".J-alert").find("input[name=mobile]");return!e.hasClass("disable")&&(n.val()==s.mobile.value?(UNotice.show("该手机号码已绑定",-1),!1):void(Tools.isMobile(n.val())?(a(e),ajax({url:o.sendCoreUrl,data:{mobile:n.val()}}).done(function(a){UNotice.show(a.msg,a.status)})):UNotice.show("手机格式不正确",-1)))}),c.find(".J-save-mobile").on("click",function(){var a=$(this).parents(".J-alert"),e=serializeObject(a);return e.mobile===s.mobile.value?(a.hide(),!1):""==e.verifyCode?(UNotice.show("请输入验证码",-1),!1):void ajax({url:o.bindPhoneUrl,data:e}).done(function(n){UNotice.show(n.msg,n.status),1==n.status&&(s.mobile.value=e.mobile,c.find(".J-mobile").html(e.mobile),a.hide().find("input[name=verifyCode]").val(""))})}),c.find(".J-save-email").on("click",function(){var a=$(this).parents(".J-alert"),e=serializeObject(a);return e.email===s.email.value?(a.hide(),!1):l.email<=0?(UNotice.show("本月的邮箱修改次数已经用完",-1),!1):void(Tools.isEmail(e.email)?ajax({url:o.saveUrl,data:e}).done(function(n){UNotice.show(n.msg,n.status),1==n.status&&(s.email.value=e.email,c.find(".J-email").html(e.email),c.find(".J-email-count").html(--l.email),a.hide())}):UNotice.show("邮箱格式不正确",-1))}),c.find(".J-save-bank").on("click",function(){function a(){for(var a in t)if(!s[a]||t[a]!=s[a].value)return!1;return!0}function e(){for(var a in t)if(t[a].length<1&&"bank_name_other"!==a){var e=n.find("input[name="+a+"]").focus();return UNotice.show(e[0].title+"格式不正确",-1),!1}return!0}var n=$(this).parents(".J-alert"),t=serializeObject(n);return a()?(n.hide(),!1):l.bank_accout<=0?(UNotice.show("本月结算账户的修改次数已经用完",-1),!1):void(e()&&(t.bank_name=t.bank_name+(t.bank_name_other?"-"+t.bank_name_other:""),ajax({url:o.saveUrl,data:t}).done(function(a){if(UNotice.show(a.msg,a.status),1==a.status){for(var e in t)"_csrf"!=e&&(s[e]||(s[e]={}),s[e].value=t[e]);c.find(".J-bank_account_holder").html(t.bank_account_holder),c.find(".J-bank-count").html(--l.bank_accout),n.hide()}})))}),c.find(".J-bank-file").on("change",function(){if(l.bank_accout<=0)return UNotice.show("本月结算账户的修改次数已经用完",-1),!1;var a=$(this),e=c.find(".J-progress").show();Tools.uploadFileHandle(o.bankPicUrl,this.files[0],function(n){return e.html("").hide(),1!=n.status?(a.val(""),UNotice.show(n.msg,n.status),!1):(c.find("input[name=bank_card_photo]").val(n.data.resource_id),void c.find("img").replaceWith(Ui.buildImage(n.data.path)))},function(a){e.html("上传进度:"+a+"%")})}),c.find(".J-save-password").on("click",function(){function a(){return n.oldPassword.length<1?(UNotice.show("请填写旧密码",-1),e.find("input[name=oldPassword]").focus(),!1):n.password.length<6||n.password.length>20?(UNotice.show("密码格式不正确",-1),e.find("input[name=password]").focus(),!1):n.enpassword===n.password||(UNotice.show("重复新密码与新密码不一致",-1),e.find("input[name=enpassword]").focus(),!1)}var e=$(this).parents(".J-alert"),n=serializeObject(e);a()&&ajax({url:o.saveUrl,data:n}).done(function(a){UNotice.show(a.msg,a.status),1==a.status&&e.hide().find("input").val("")})}),e()}});