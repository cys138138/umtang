window.ShopInfo=PageBase.init(function(){this.initPage=function(){function a(){var a,e=r.aCommercialTenantShop;c.find("img").replaceWith(Ui.buildImage(e.profile.path));for(a in e)c.find(".J-"+a).html(e[a].value),c.find("[name="+a+"]").val(e[a].value);c.find(".J-profile-all").html(r.aModifyLimitCount.profile);for(a in d)c.find(".J-count-"+a).html(d[a]);var i={address:e.address.value,location:{lng:e.lng.value,lat:e.lat.value},adcode:n.getConfig("adcode")};t=UmtMapSelector.build(i),$("#map").append(t),t.find(".J-location-btn").attr("type","button");var o,l,s,m=r.aCommercialTenantTypeList,h="",f=c.find(".J-type-list"),p=f.find(".J-type-item").remove();for(o=0,l=m.length;o<l;o++){var u=p.clone();u.find("input").val(m[o].id),u.find("span").html(m[o].name),f.append(u)}var v;if(r.aCommercialTenantShop.commercial_tenant_type)v=r.aCommercialTenantShop.commercial_tenant_type.value;else{if(!r.aCommercialTenantShop.commercial_type_info)return;v=r.aCommercialTenantShop.commercial_type_info.value}for(o=0,l=v.length;o<l;o++)s=f.find("[type=checkbox][value="+v[o]+"]").prop("checked",!0),h+="<span>"+s.siblings("span").html()+"</span>";c.find(".J-type-name").html(h)}var e,t,n=this,i=n.getConfig("selector"),o=n.getConfig("template"),l=n.getConfig("url"),r=n.getConfig("phpData"),s=n.getConfig("pageUrl"),c=$(i).html(o),d=r.aRemainModifyCount;for(var m in s)c.find(".J-tab-"+m).attr("href",s[m]);c.find(".J-show-alert").on("click",function(){e=$(this).data("type"),c.find(".J-alert-"+e).show()}),c.find(".J-close-alert").on("click",function(){$(this).parents(".J-alert").hide()}).click(),c.find(".J-change-head").on("change",function(){if(d.profile<=0)return UNotice.show("本月头像的修改次数已用完",-1),!1;var a=$(this),e=c.find(".J-profile-look img");Tools.uploadFileHandle(l.headerUrl,this.files[0],function(t){return 1!=t.status?(a.val(""),UNotice.show(t.msg,t.status),!1):(e.replaceWith(Ui.buildImage(t.data.path)),void c.find("input[name=profile]").data("path",t.data.path).val(t.data.resource_id))})}),c.find(".J-save-profile").on("click",function(){var a=$(this).parents(".J-alert"),e=a.find("[name=profile]").val(),t=a.find("[name=profile]").data("path");return e==r.aCommercialTenantShop.profile.value?(a.hide(),!1):d.profile<=0?(UNotice.show("本月头像的修改次数已用完",-1),!1):void(e.length>0?ajax({url:l.saveUrl,data:{profile:e}}).done(function(n){UNotice.show(n.msg,n.status),1==n.status&&(r.aCommercialTenantShop.profile.value=e,c.find(".J-count-profile").html(--d.profile),c.find(".J-profile-pic img").replaceWith(Ui.buildImage(t)),a.hide())}):UNotice.show("请上传头像",-1))}),c.find(".J-save-name").on("click",function(){var a=$(this).parents(".J-alert"),e=a.find("[name=name]").val();return e===r.aCommercialTenantShop.name.value?(a.hide(),!1):d.name<=0?(UNotice.show("本月商铺名称的修改次数已用完",-1),!1):void(e.length>0?ajax({url:l.saveUrl,data:{name:e}}).done(function(t){UNotice.show(t.msg,t.status),1==t.status&&(r.aCommercialTenantShop.name.value=e,c.find(".J-count-name").html(--d.name),c.find(".J-name").html(e),a.hide())}):UNotice.show("请输入商铺名称",-1))}),c.find(".J-save-map").on("click",function(){var a=$(this).parents(".J-alert"),e={},n=UmtMapSelector.parseData(t);return n.address===r.aCommercialTenantShop.address.value?(c.find(".J-close-alert").click(),!1):n.address?d.address<=0?(UNotice.show("本月商铺名称的修改次数已用完",-1),!1):(e.lng=n.location.lng,e.lat=n.location.lat,e.address=n.address,void ajax({url:l.saveUrl,data:e}).done(function(t){UNotice.show(t.msg,t.status),1==t.status&&(r.aCommercialTenantShop.address.value=e.address,c.find(".J-count-address").html(--d.address),c.find(".J-address").html(e.address),a.hide())})):(UNotice.show("请填写详细地址",-1),!1)}),c.find(".J-save-contact_number").on("click",function(){var a=$(this).parents(".J-alert"),e=a.find("[name=contact_number]").val();return e===r.aCommercialTenantShop.contact_number.value?(a.hide(),!1):void(e.length>0?ajax({url:l.saveUrl,data:{contact_number:e}}).done(function(t){UNotice.show(t.msg,t.status),1==t.status&&(r.aCommercialTenantShop.contact_number.value=e,c.find(".J-contact_number").html(e),a.hide())}):UNotice.show("请输入商铺电话",-1))}),c.find(".J-save-type").on("click",function(){var a=$(this).parents(".J-alert"),e=[],t="",n=a.find("input:checked");n.length>0?(n.each(function(){var a=$(this);e.push(a.val()),t+="<span>"+a.siblings("span").html()+"</span>"}),ajax({url:l.saveUrl,data:{commercial_tenant_type:e}}).done(function(a){UNotice.show(a.msg,a.status),1==a.status&&c.find(".J-type-name").html(t)})):UNotice.show("请至少选择一种商铺分类",-1)}),c.find(".J-save-description").on("click",function(){var a=$(this).parents(".J-alert"),e=a.find("[name=description]").val();return e===r.aCommercialTenantShop.description.value?(a.hide(),!1):d.description<=0?(UNotice.show("本月商铺描叙的修改次数已用完",-1),!1):void(e.length>0?ajax({url:l.saveUrl,data:{description:e}}).done(function(t){UNotice.show(t.msg,t.status),1==t.status&&(r.aCommercialTenantShop.description.value=e,c.find(".J-count-description").html(--d.description),c.find(".J-description").html(e),a.hide())}):UNotice.show("请输入商户描述",-1))}),a()}});