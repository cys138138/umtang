window.EncashList=window.PageBase.init(function(){function e(e,t){e.toggleClass("hide",0==t.length),PageBase.cloneItem(e,t.length,!0).each(function(e){var a=$(this),i=t[e],n=1==i.type;if(i.goods_info)a.find(".J-no").text(i.order_num),a.find(".J-name").text(n?"买单":i.goods_info.name),a.find(".J-amount").text(n?1:i.quantity),a.find(".J-price").text(Tools.parsePrice(i.price)),a.find(".J-charge").text(Tools.parsePrice(i.fee)),a.find(".J-encash").text(Tools.parsePrice(i.price-i.fee));else{var s=0==i.is_finish;a.find(".J-money").text(Tools.parsePrice(i.amount)),a.find(".J-start-date").text(Tools.date("Y-m-d H:i:s",i.create_time)),a.find(".J-finish-date").text(0==i.finish_time?"-":Tools.date("Y-m-d H:i:s",i.finish_time)),a.find(".J-status").text(s?"提取中":"已到账").toggleClass("pending",s)}})}var t={aStatusDesc:"",listCache:[]};this.initPage=function(){var a=this,i=a.getConfig("selector"),n=a.getTemplate(),s=$(n);t.aStatusDesc=a.getConfig("aStatusDesc"),s.find(".J-encash").attr("href",a.getConfig("encashUrl")),s.find(".J-order").attr("href",a.getConfig("orderUrl")),s.find(".J-history").attr("href",a.getConfig("historyUrl")),s.find('input[type="radio"]').change(function(){var e=$(this),t=e.next().text(),a=e.parent().parent();a.addClass("hide"),a.next().text(t),d.triggerHandler(UmtPageNum.EVENT_PAGE_CHANGE,1)});var r=a.getConfig("aTimeStatus");r&&(PageBase.cloneItem(s.find(".J-time-status"),r.length,!0,!0).each(function(e){var t=$(this),a=r[e].value;t.find("input").val(r[e].key).prop("checked",0==e),t.find("span").text(a),0==e&&t.parent().next().text(a)}),r=a.getConfig("aOrderStatus"),PageBase.cloneItem(s.find(".J-evaluate-status"),r.length,!0,!0).each(function(e){var t=$(this),a=r[e].value;t.find("input").val(r[e].key).prop("checked",0==e),t.find("span").text(a),0==e&&t.parent().next().text(a)})),s.find(".J-radio-current").click(function(){$(this).prev().toggleClass("hide")}),s.find(".J-encashment").text(Tools.parsePrice(a.getConfig("encashment"))),s.find(".J-extracting").text(Tools.parsePrice(a.getConfig("extracting")));var o=a.getConfig("orderListUrl"),d=UmtPageNum.build();d.bind(UmtPageNum.EVENT_PAGE_CHANGE,function(a,i){var n=s.find(".J-item"),r=s.find('[name="timeStatus"]:checked').val(),c=s.find('[name="evaluateStatus"]:checked').val(),f=[r,c,i].join("_");if(t.listCache[f])return UmtPageNum.update(d,i),void e(n,t.listCache[f]);var g=10;ajax({url:o,data:{time:r,status:c,page:i,pageSize:g}}).done(function(a){var r=Math.ceil(a.data.count/g);s.find(".J-total-income").text(Tools.parsePrice(a.data.totalOrderPrice)),t.listCache[f]=a.data.list,e(n,t.listCache[f]),UmtPageNum.update(d,i,r)})}),s.find(".J-page-num").append(d),$(i).append(s),d.triggerHandler(UmtPageNum.EVENT_PAGE_CHANGE,1)}});